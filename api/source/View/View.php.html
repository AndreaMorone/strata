<html>
    <head>
        <script
            type="text/javascript"
            src="../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
namespace Strata\View;

use Strata\View\Template;
use Strata\View\Helper\Helper;
use Strata\Utility\Inflector;
use Strata\Router\Router;

/**
 * Handles the generation of view html. It is important to understand this is not used
 * when a request continues the regular Wordpress flow which generates its own templates.
 *
 * This class is used when a controller is printing the view object itself, as it is often the
 * case for AJAX, file downloads and numeric returns.
 */
class View {

    /**
     * Rendering options, used when explicitly rendering a view from a controller.
     * @var array
     */
    protected $options = array();

    /**
     * The list of variables to be declared when loading the view
     * @var array
     */
    protected $templateVars = array();

    public function loadTemplate($path)
    {
        return Template::parse($path, $this-&gt;getVariables());
    }

    public function loadHelper($helperName, $config = array())
    {
        $helper = Helper::factory($helperName, $config);
        $name = array_key_exists(&quot;name&quot;, (array)$config) ? $config[&quot;name&quot;] : $helper-&gt;getShortName();
        $this-&gt;set($name, $helper);
    }

    /**
     * Assigns the variable to the current view
     */
    public function set($name, $value)
    {
        $this-&gt;templateVars[$name] = $value;
    }

    /**
     * Returns the list of currently declared variables in this view.
     * @return array An associative array of values
     */
    public function getVariables()
    {
        return $this-&gt;templateVars;
    }

    /**
     * Returns a variable assigned to the current view
     * @return mixed
     */
    public function get($name)
    {
        return $this-&gt;templateVars[$name];
    }

    /**
     * Checks whether a variable is assigned to the current view
     * @return boolean
     */
    public function check($name)
    {
        return array_key_exists($name, $this-&gt;templateVars);
    }

    /**
     * Renders on the page and end the process. Useful for simple HTML returns or data in another format like JSON.
     * @param  array $options An associative array of rendering options
     * @return string          The rendered content.
     */
    public function render($options = array())
    {
        $this-&gt;options = $options + array(
            &quot;Content-type&quot; =&gt; &quot;text/html&quot;,
            &quot;Content-disposition&quot; =&gt; null,
            &quot;content&quot; =&gt; &quot;&quot;,
            // Only the admin does not end Wordpress' parsing of the views
            // because we hook in the middle of the page.
            &quot;end&quot; =&gt;  is_admin() &amp;&amp; !Router::isAjax() ? false : true
        );

        $content = $this-&gt;parseCurrentContent();

        if ((bool)$this-&gt;options['end']) {
            // Only play with headers when we know we will
            // kill the process.
            $this-&gt;applyHeaders();

            echo $content;
            exit();
        }

        echo $content;
    }

    /**
     * Takes the current value of the content option and ensure that it is
     * correctly formatted for output. If the content is an array or an object, the value.
     * is encoded to a json string. Otherwise, the content simply cast into string.
     * @return string The content of the view
     */
    protected function parseCurrentContent()
    {
        if (is_array($this-&gt;options['content']) || is_object($this-&gt;options['content'])) {
            return json_encode($this-&gt;options['content']);
        }

        return &quot;&quot; . $this-&gt;options['content'];
    }

    /**
     * Applies header values sent as options. For the time being, only Content-type and Content-disposition
     * are supported.
     * @return null
     */
    protected function applyHeaders()
    {
        if ($this-&gt;options['Content-type'] != &quot;text/html&quot;) {
            header('Content-type: ' . $this-&gt;options['Content-type']);
        }

        if (!is_null($this-&gt;options['Content-disposition'])) {
            header('Content-disposition: ' . $this-&gt;options['Content-disposition']);
        }
    }

}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>